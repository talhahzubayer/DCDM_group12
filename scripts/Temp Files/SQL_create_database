
# 1. Create Core Tables

# Genes table
CREATE TABLE Genes (
    gene_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    gene_symbol VARCHAR(100) NOT NULL,
    gene_accession_id VARCHAR(50) UNIQUE,
    parameter_name VARCHAR(200)
);
# Mouse characteristics
CREATE TABLE MouseCharacteristics (
    mouse_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    mouse_strain VARCHAR(100) NOT NULL,
    mouse_life_stage VARCHAR(100) NOT NULL
);
# Parameters table
CREATE TABLE Parameters (
    parameter_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    IMPC_parameter_id VARCHAR(20) UNIQUE,
    parameter_description VARCHAR(100) NOT NULL,
    group_id INT,
    IMPC_parameter_origin_id VARCHAR(100) NOT NULL
);
# Parameter Groups
CREATE TABLE Parameter_Groups (
    group_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    group_name VARCHAR(50) NOT NULL,
    description VARCHAR(255)
);
# Analysis table
CREATE TABLE Analysis (
    analysis_key_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    pvalue VARCHAR(100) NOT NULL,
    analysis_id VARCHAR(100),
    gene_accession_id VARCHAR(100),
    mouse_id INT,
    gene_id INT,
    parameter_id INT,
    IMPC_parameter_id VARCHAR(20)
);
# Diseases table
CREATE TABLE Diseases (
    disease_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    disease_name VARCHAR(200) NOT NULL,
    gene_accession_id VARCHAR(50),
    gene_id INT,
    omim_id VARCHAR(20)
    DO_ID VARCHAR(50) NOT NULL
);

# Procedure table
CREATE TABLE Procedures (
    IMPC_procedure_id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    procedure_name VARCHAR(100) NOT NULL
    procedure_description VARCHAR(1000) NULL
    mandatory TINYINT(1)
    IMPC_parameter_id VARCHAR(20) NULL
    IMPC_parameter_origin_id VARCHAR(50) NOT NULL
);

 
# 2. Add Foreign Keys


ALTER TABLE Analysis
ADD CONSTRAINT fk_analysis_gene
FOREIGN KEY (gene_id) REFERENCES Genes(gene_id)
ON DELETE SET NULL;

ALTER TABLE Analysis
ADD CONSTRAINT fk_analysis_mouse
FOREIGN KEY (mouse_id) REFERENCES MouseCharacteristics(mouse_id)
ON DELETE SET NULL;

ALTER TABLE Analysis
ADD CONSTRAINT fk_analysis_parameter
FOREIGN KEY (parameter_id) REFERENCES Parameters(parameter_id);

INSERT INTO Analysis (pvalue, analysis_id, gene_accession_id)
SELECT pvalue, analysis_id, gene_accession_id
FROM Genes;


-- Link Analysis to Genes by gene_accession_id
UPDATE Analysis a
JOIN Genes g ON a.gene_accession_id = g.gene_accession_id
SET a.gene_id = g.gene_id;

-- Link Analysis to MouseCharacteristics
UPDATE Analysis a
JOIN MouseCharacteristics m ON a.mouse_strain = m.mouse_strain
SET a.mouse_id = m.mouse_id;


ALTER TABLE Parameters
ADD CONSTRAINT fk_group
FOREIGN KEY (group_id) REFERENCES Parameter_Groups(group_id)
ON DELETE SET NULL;

ALTER TABLE Diseases
ADD CONSTRAINT fk_diseases_gene
FOREIGN KEY (gene_id) REFERENCES Genes(gene_id)
ON UPDATE CASCADE
ON DELETE RESTRICT;

ALTER TABLE Gene_Disease_Association
ADD CONSTRAINT fk_gene
FOREIGN KEY (gene_id) REFERENCES Genes(gene_id),
ADD CONSTRAINT fk_disease
FOREIGN KEY (disease_id) REFERENCES Diseases(disease_id);


# 3. Insert Parameter Groups

INSERT INTO Parameter_Groups (group_name, description)
VALUES
('Housing & Environment', 'Mouse husbandry, caging, diet, ambient factors'),
('Structural Phenotype', 'Physical and structural measurements'),
('Clinical Chemistry/Blood', 'Hematology and blood chemistry'),
('Embryo & Development', 'Embryo, viability, and developmental defects'),
('Limb Function & Performance', 'Strength, movement, grip measures'),
('Behavioral & Neurological', 'Activity, behavior, neurological function'),
('Cardiovascular & ECG', 'Heart function, ECG measurements'),
('Other', 'Miscellaneous parameters');

-- Assuming parameter_id is already populated in Analysis:
UPDATE Analysis a
JOIN Parameters p ON a.parameter_id = p.parameter_id
SET a.IMPC_parameter_id = p.IMPC_parameter_id;

-- Populate MouseCharacteristics from Genes

INSERT INTO MouseCharacteristics (mouse_strain, mouse_life_stage)
SELECT DISTINCT mouse_strain, mouse_life_stage
FROM Genes;



I
